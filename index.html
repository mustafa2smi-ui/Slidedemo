<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Islamic Q&A, Dua, Hajj, and Fiqh solutions with authentic references.">
  <meta property="og:title" content="Darul Islam Q&A" />
  <meta property="og:description" content="Authentic Islamic Questions and Answers." />
  <meta property="og:image" content="icon-512.png" />
  <meta property="og:url" content="https://YOUR-NETLIFY-URL.netlify.app" />
  <title>Darul Islam Q&A</title>
  <link rel="manifest" href="manifest.json" />
  <style>
    body {font-family: sans-serif; background:#f9f9f9; margin:0; padding:0;}
    header {background:#004d40; color:white; padding:15px; text-align:center;}
    .card {background:white; margin:15px; padding:15px; border-radius:12px; box-shadow:0 2px 5px rgba(0,0,0,0.1);}
    .card img {max-width:100%; border-radius:10px; margin-top:8px;}
    .share-btn, .img-share-btn {background:#00897b; color:white; border:none; padding:8px 15px; border-radius:8px; cursor:pointer; margin-top:10px;}
    .img-share-btn {background:#4caf50;}
    .menu {background:#004d40; color:white; display:flex; justify-content:space-around; padding:10px;}
    .menu a {color:white; text-decoration:none; font-weight:bold;}
  </style>
</head>
<body>
  <header>
    <h2>Darul Islam Q&A</h2>
  </header>

  <!-- Simple Hamburger Menu -->
  <div class="menu">
    <a href="#" onclick="loadSheet('qa')">Q&A</a>
    <a href="#" onclick="loadSheet('dua')">Dua</a>
    <a href="#" onclick="loadSheet('rabbana')">Rabbana</a>
  </div>

  <div id="posts"></div>

  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script>
    
  const sheets = {
    qa: "https://docs.google.com/spreadsheets/d/1lnXSvR2j6hTGWT_Bj7H3BTnDtpnPWQJl0OdpffeWWr4/gviz/tq?tqx=out:json",
    dua: "https://docs.google.com/spreadsheets/d/1DtRlkaP23ihYmN8mn4Gx7deLicpVhDY6AiY-bN5pqt8/gviz/tq?tqx=out:json",
    rabbana: "https://docs.google.com/spreadsheets/d/YOUR_RABBANA_SHEET_ID/gviz/tq?tqx=out:json"
  };

  async function loadSheet(type='qa') {
    document.getElementById('posts').innerHTML = "<p style='text-align:center'>‚è≥ Loading...</p>";
    const url = sheets[type];
    try {
      const res = await fetch(url);
      const text = await res.text();
      const json = JSON.parse(text.substr(47).slice(0, -2));
      const rows = json.table.rows;
      let html = "";

      rows.forEach(r=>{
        const p = r.c.map(c=>c?c.v:"");
        const title = p[0] || "Untitled";
        const q = p[1] || "";
        const a = p[2] || "";
        const ref = p[3] || "";
        const link = p[4] || "";
        const date = p[5] || "";
        const img = p[6] || "";

        // YouTube embed logic
        let embed = "";
        if (link.includes("youtube.com/watch?v=")) {
          const embedLink = link.replace("watch?v=", "embed/");
          embed = `<iframe width="100%" height="200" src="${embedLink}" frameborder="0" allowfullscreen></iframe>`;
        }

        html += `
          <div class="card">
            <h3>${title}</h3>
            ${q ? `<p><b>Q:</b> ${q}</p>` : ""}
            ${a ? `<p><b>A:</b> ${a}</p>` : ""}
            ${ref ? `<p><b>Ref:</b> ${ref}</p>` : ""}
            ${link && !embed ? `<p><a href="${link}" target="_blank">üîó Link</a></p>` : ""}
            ${embed}
            ${img ? `<img src="${img}" alt="Image">` : ""}
            ${date ? `<p><small>üìÖ ${date}</small></p>` : ""}
            <button class="img-share-btn" onclick="shareCardImage(this)">üì∏ Share as Image</button>
          </div>`;
      });
      document.getElementById('posts').innerHTML = html;
    } catch(err) {
      document.getElementById('posts').innerHTML = "‚ùå Error loading data.";
      console.error(err);
    }
  }

  async function shareCardImage(btn) {
    const card = btn.closest('.card');
    if (!card) return;
    try {
      const canvas = await html2canvas(card);
      const blob = await new Promise(res => canvas.toBlob(res, 'image/png'));
      const file = new File([blob], 'qa.png', { type: 'image/png' });
      if (navigator.canShare && navigator.canShare({ files: [file] })) {
        await navigator.share({ title: 'Islamic Q&A', text: 'Check this answer', files: [file] });
      } else {
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = 'qa.png';
        a.click();
      }
    } catch(e) {
      alert("Cannot share: " + e.message);
    }
  }

    /*
    // Sheet URLs
const sheets = {
  qa: "https://docs.google.com/spreadsheets/d/1lnXSvR2j6hTGWT_Bj7H3BTnDtpnPWQJl0OdpffeWWr4/gviz/tq?tqx=out:json",
  dua: "https://docs.google.com/spreadsheets/d/1DtRlkaP23ihYmN8mn4Gx7deLicpVhDY6AiY-bN5pqt8/gviz/tq?tqx=out:json",
  rabbana: "https://docs.google.com/spreadsheets/d/ID3/gviz/tq?tqx=out:json",
  hajj: "https://docs.google.com/spreadsheets/d/ID4/gviz/tq?tqx=out:json"
};

// Theme colors
const themeColors = {
  qa: "#ffe0b2",
  dua: "#e8f5e9",
  rabbana: "#e3f2fd",
  hajj: "#fff3e0"
};

// Load a sheet
async function loadSheet(type='qa') {
  document.body.style.background = themeColors[type] || "#f7f7f7";
  const sheetUrl = sheets[type];
  if (!sheetUrl) return alert("Sheet URL missing!");

  const res = await fetch(sheetUrl);
  const text = await res.text();
  const json = JSON.parse(text.substring(47, text.length - 2));
  const rows = json.table.rows;
  
  // Convert sheet rows to posts
  const posts = rows.slice(1).map((r, i) => ({
    id: i+1,
    title: r.c[0]?.v || "",
    question: r.c[1]?.v || "",
    answer: r.c[2]?.v || "",
    reference: r.c[3]?.v || "",
    link: r.c[4]?.v || "",
    date: r.c[5]?.v || "",
    image: r.c[6]?.v || ""
  })).filter(p => p.title);

  renderPosts(posts);
}

// Render homepage (titles only)
function renderPosts(posts) {
  const container = document.getElementById("postsContainer");
  container.innerHTML = posts.map(p => `
    <div class="post-card" onclick="openPost(${p.id})">
      <h3>${p.title}</h3>
    </div>
  `).join('');
  window.allPosts = posts;
  document.getElementById("postsContainer").classList.remove("hidden");
  document.getElementById("detailContainer").classList.add("hidden");
}

// Detail card
function openPost(id) {
  const p = window.allPosts.find(x=>x.id===id);
  const d = document.getElementById("detailContainer");

  let youtubeEmbed = "";
  if(p.link && p.link.includes("youtube.com")) {
    const videoId = p.link.split("v=")[1]?.split("&")[0];
    if(videoId) youtubeEmbed = `<iframe width="100%" height="200" src="https://www.youtube.com/embed/${videoId}" frameborder="0" allowfullscreen></iframe>`;
  }

  d.innerHTML = `
    <div class="detail-card" id="detailCard">
      <h3>${p.title}</h3>
      <p><b>Q:</b> ${p.question || "‚Äî"}</p>
      <p><b>A:</b> ${p.answer || "‚Äî"}</p>
      <p><i>${p.reference || "‚Äî"}</i></p>
      <p><b>Link:</b> ${p.link ? `<a href="${p.link}" target="_blank">${p.link}</a>` : "‚Äî"}</p>
      <p><b>Last Update:</b> ${p.date || "‚Äî"}</p>
      ${p.image ? `<p><b>Image:</b><br><img src="${p.image}" style="max-width:100%;border-radius:10px;"></p>` : ""}
      ${youtubeEmbed}
      <div>
        <button class="back-btn" onclick="goBack()">‚¨Ö Back</button>
        <button class="color-btn" onclick="changeColor()">üé® Change BG</button>
        <button class="share-btn" onclick="shareAsImage(${encodeURIComponent(JSON.stringify(p))})">üì§ Share</button>
      </div>
    </div>
  `;
  document.getElementById("postsContainer").classList.add("hidden");
  d.classList.remove("hidden");
}

// Back to homepage
function goBack() {
  document.getElementById("detailContainer").classList.add("hidden");
  document.getElementById("postsContainer").classList.remove("hidden");
}

// Gradient background for detail card
function changeColor() {
  const card = document.getElementById("detailCard");
  const gradients = [
    "linear-gradient(135deg,#ffecd2,#fcb69f)",
    "linear-gradient(135deg,#a1c4fd,#c2e9fb)",
    "linear-gradient(135deg,#fddb92,#d1fdff)",
    "linear-gradient(135deg,#84fab0,#8fd3f4)",
    "linear-gradient(135deg,#fccb90,#d57eeb)",
    "linear-gradient(135deg,#e0c3fc,#8ec5fc)"
  ];
  card.style.background = gradients[Math.floor(Math.random()*gradients.length)];
}

// Share card as image (without buttons)
async function shareAsImage(post) {
  const card = document.getElementById("detailCard");
  const buttons = card.querySelectorAll("button");
  buttons.forEach(b=>b.style.display="none");

  const canvas = await html2canvas(card);
  buttons.forEach(b=>b.style.display="");

  canvas.toBlob(blob=>{
    const file = new File([blob],"question.png",{type:"image/png"});
    if(navigator.share){
      navigator.share({
        title: post.title,
        text: post.answer || "",
        url: window.location.href,
        files: [file]
      }).catch(()=>alert("Share canceled or failed"));
    } else {
      alert("Your browser does not support sharing API");
    }
  });
}
    */
  // Load default sheet
  loadSheet('qa');

  // Register service worker for PWA
  if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("./service-worker.js")
      .then(()=>console.log("‚úÖ PWA active"))
      .catch(err=>console.error("SW failed:", err));
  }
  </script>
</body>
</html>
