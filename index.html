<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DarulIslam Q&A Slides</title>
<style>
body { font-family:"Poppins",sans-serif; background:#f4f4f4; margin:0; padding:0; }
header { text-align:center; background:#1a237e; color:white; padding:15px; font-size:20px; font-weight:bold;}
.container { max-width:700px; margin:20px auto; padding:15px;}
.slide-item { background:white; padding:12px; margin:8px 0; border-radius:10px; cursor:pointer; box-shadow:0 2px 4px rgba(0,0,0,0.2);}
.slide-item:hover { background:#e3f2fd;}
#slideViewer { display:none; text-align:center;}
#slideViewer iframe { width:100%; height:400px; border:none; border-radius:10px; transition:background 0.3s;}
button { padding:8px 12px; margin:6px; border:none; border-radius:8px; background:#1a237e; color:white; cursor:pointer;}
button:hover { background:#3949ab;}
.actions { margin-top:10px; }
</style>
</head>
<body>

<header>üïå DarulIslam Q&A</header>
<div class="container">
  <div id="slideList">Loading slides...</div>

  <div id="slideViewer">
    <iframe id="slideFrame"></iframe>
    <div class="actions">
      <button id="backBtn">‚¨ÖÔ∏è Back</button>
      <button id="colorBtn">üé® Change Background</button>
      <button id="shareBtn">üì§ Share as Image</button>
    </div>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script>
// 1Ô∏è‚É£ Google Sheet JSON URL
const sheetID = "https://docs.google.com/spreadsheets/d/1lnXSvR2j6hTGWT_Bj7H3BTnDtpnPWQJl0OdpffeWWr4/gviz/tq?tqx=out:json"; // <-- Replace with your Sheet ID
const sheetURL = `https://docs.google.com/spreadsheets/d/${sheetID}/gviz/tq?tqx=out:json`;

// 2Ô∏è‚É£ Fetch data from Sheet
fetch(sheetURL)
.then(res => res.text())
.then(txt => {
  // Sheet JSON is wrapped, remove extra chars
  const json = JSON.parse(txt.substr(47).slice(0,-2));
  const rows = json.table.rows;
  loadSlideList(rows);
})
.catch(err => {
  document.getElementById("slideList").textContent = "Error loading slides!";
  console.error(err);
});

// 3Ô∏è‚É£ Load slide list
function loadSlideList(rows){
  const listDiv = document.getElementById("slideList");
  listDiv.innerHTML = "";
  rows.forEach((r,i)=>{
    const title = r.c[0]?.v || "Slide "+(i+1);
    const url = r.c[1]?.v || "#";
    const div = document.createElement("div");
    div.className = "slide-item";
    div.textContent = title;
    div.onclick = ()=> openSlide(url);
    listDiv.appendChild(div);
  });
}

// 4Ô∏è‚É£ Slide open
const viewer = document.getElementById("slideViewer");
const frame = document.getElementById("slideFrame");
function openSlide(url){
  document.getElementById("slideList").style.display = "none";
  viewer.style.display = "block";
  frame.src = url;
}

// 5Ô∏è‚É£ Back button
document.getElementById("backBtn").onclick = ()=>{
  viewer.style.display = "none";
  document.getElementById("slideList").style.display = "block";
}

// 6Ô∏è‚É£ Change only slide background
const colors = ["#ffffff","#fff3e0","#e3f2fd","#e8f5e9","#ede7f6"];
let colorIndex = 0;
document.getElementById("colorBtn").onclick = ()=>{
  colorIndex = (colorIndex+1) % colors.length;
  frame.style.backgroundColor = colors[colorIndex];
}

// 7Ô∏è‚É£ Share as image
document.getElementById("shareBtn").onclick = async ()=>{
  const canvas = await html2canvas(frame);
  canvas.toBlob(blob=>{
    const file = new File([blob],"slide.png",{type:"image/png"});
    if(navigator.share){
      navigator.share({files:[file],title:"DarulIslam Slide"});
    } else alert("Sharing not supported on this device.");
  });
}
</script>

</body>
</html>
